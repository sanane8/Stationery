{% extends 'base.html' %}
{% load humanize tz %}

{% block title %}Invoice #{{ sale.id }}{% endblock %}

{% block content %}
<style>
    /* Print-friendly adjustments */
    @media print {
        body { background: #fff; }
        .no-print { display: none !important; }
    }
    .invoice-header { margin-bottom: 1rem; }
    .invoice-meta { margin-bottom: 1rem; }
    .invoice-table th, .invoice-table td { padding: .5rem; }
</style>
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <h5 class="m-0">Invoice #{{ sale.id }}</h5>
            <small class="text-muted">{{ sale.sale_date|localtime|date:"F d, Y H:i" }}</small>
        </div>
        <div class="no-print">
            <a href="#" onclick="window.print(); return false;" class="btn btn-primary me-2">
                <i class="fas fa-print"></i> Print
            </a>
            <a href="{% url 'sale_detail' sale.pk %}" class="btn btn-outline-secondary">Back</a>
        </div>
    </div>
    <div class="card-body">
        <div class="row invoice-header">
            <div class="col-md-6">
                <h6>From</h6>
                <strong>Stationery Tracker</strong><br>
                <small class="text-muted">Your Company Name</small>
            </div>
            <div class="col-md-6 text-end">
                <h6>To</h6>
                {% if sale.customer %}
                    <strong>{{ sale.customer.name }}</strong><br>
                    {% if sale.customer.email %}{{ sale.customer.email }}<br>{% endif %}
                    {% if sale.customer.phone %}{{ sale.customer.phone }}<br>{% endif %}
                {% else %}
                    <strong>Walk-in Customer</strong>
                {% endif %}
            </div>
        </div>

        <div class="invoice-meta row mb-3">
            <div class="col-md-6">
                <div><strong>Payment Method:</strong> {{ sale.get_payment_method_display }}</div>
                <div><strong>Status:</strong> {% if sale.is_paid %}<span class="badge bg-success">Paid</span>{% else %}<span class="badge bg-warning">Unpaid</span>{% endif %}</div>
            </div>
            <div class="col-md-6 text-end">
                <div><strong>Created By:</strong> {% if sale.created_by %}{{ sale.created_by.get_full_name|default:sale.created_by.username }}{% else %}-{% endif %}</div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered invoice-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th class="text-end">Quantity</th>
                        <th class="text-end">Unit Price</th>
                        <th class="text-end">Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for it in sale_items %}
                    <tr>
                        <td>{{ it.item.name }}</td>
                        <td class="text-end">{{ it.quantity }}</td>
                        <td class="text-end">TZS {{ it.unit_price|floatformat:0|intcomma }}</td>
                        <td class="text-end">TZS {{ it.total_price|floatformat:0|intcomma }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="3" class="text-end">Subtotal</th>
                        <th class="text-end">TZS {{ revenue|floatformat:0|intcomma }}</th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">Cost</th>
                        <th class="text-end">TZS {{ total_cost|floatformat:0|intcomma }}</th>
                    </tr>
                    <tr class="table-active">
                        <th colspan="3" class="text-end">Total</th>
                        <th class="text-end">TZS {{ revenue|floatformat:0|intcomma }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>

        {% if sale.notes %}
        <div class="mt-3">
            <h6>Notes</h6>
            <p>{{ sale.notes }}</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
